<!DOCTYPE html>

<html>
<head>
  <title>Searching with a terms enum</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="main">

      <div class="header">
        <h1>Searching with a terms enum</h1>

        
          <div class="toc">
            <h3>Table of Contents</h3>
            <ol>
              
                
                <li>
                  <a class="source" href="AnalyzerBasics.html">
                    AnalyzerBasics.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="BooleanQueryANDInternals.html">
                    BooleanQueryANDInternals.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="BooleanQueryIntro.html">
                    BooleanQueryIntro.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="BottomUpIndexReader.html">
                    BottomUpIndexReader.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="BytesRefHashExample.html">
                    BytesRefHashExample.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="CombinedFieldQueryExample.html">
                    CombinedFieldQueryExample.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="DirectoryFileContents.html">
                    DirectoryFileContents.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="DocValuesSearchExample.html">
                    DocValuesSearchExample.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="FunctionQuerySearchExample.html">
                    FunctionQuerySearchExample.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="KnnSearchExample.html">
                    KnnSearchExample.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="PointTreeRangeQuery.html">
                    PointTreeRangeQuery.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="PrimitivesRef.html">
                    PrimitivesRef.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="SearchWithTermsEnum.html">
                    SearchWithTermsEnum.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="SimpleSearch.html">
                    SimpleSearch.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="TextVectorSearchExample.html">
                    TextVectorSearchExample.java
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="VisualizePointTree.html">
                    VisualizePointTree.java
                  </a>
                </li>
              
            </ol>
          </div>
        
      </div>
      
        
        <p>This example is essentially a repeat of SimpleSearch, but instead of using an <code>IndexSearcher</code>, we will access the
underlying index components via <code>IndexReader</code> – specifically, we’ll:</p>
<ol>
<li>Iterate through the index segments under the <code>IndexReader</code> (but there will only be one segment).</li>
<li>Load a <code>TermsEnum</code> for the <code>text</code> field.</li>
<li>Seek to the <code>fox</code> term in the enum.</li>
<li>Iterate through the matching documents via a <code>PostingsEnum</code>.</li>
<li>Explore some of the other attributes from the <code>PostingsEnum</code>.</li>
</ol>
<p>This is not intended as a “how-to” example, since you should use <code>IndexSearcher</code> for searching. Instead, it should
help demystify some of what’s happening under the <code>IndexSearcher</code>.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 15;"><span class="line" id="L15"><span style="color: #D32F2F">package</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">example</span><span style="color: #212121">.</span><span style="color: #D32F2F">basic</span><span style="color: #24292EFF">;</span></span>
<span class="line empty-line" id="L16"></span>
<span class="line" id="L17"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">document</span><span style="color: #212121">.</span><span style="color: #D32F2F">Field</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L18"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">document</span><span style="color: #212121">.</span><span style="color: #D32F2F">TextField</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L19"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">DirectoryReader</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L20"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">IndexReader</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L21"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">IndexWriter</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L22"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">IndexWriterConfig</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L23"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">IndexableField</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L24"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">LeafReader</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L25"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">LeafReaderContext</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L26"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">PostingsEnum</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L27"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">StoredFields</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L28"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">Terms</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L29"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">TermsEnum</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L30"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">search</span><span style="color: #212121">.</span><span style="color: #D32F2F">DocIdSetIterator</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L31"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">store</span><span style="color: #212121">.</span><span style="color: #D32F2F">Directory</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L32"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">store</span><span style="color: #212121">.</span><span style="color: #D32F2F">FSDirectory</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L33"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">util</span><span style="color: #212121">.</span><span style="color: #D32F2F">BytesRef</span><span style="color: #24292EFF">;</span></span>
<span class="line empty-line" id="L34"></span>
<span class="line" id="L35"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">java</span><span style="color: #212121">.</span><span style="color: #D32F2F">io</span><span style="color: #212121">.</span><span style="color: #D32F2F">IOException</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L36"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">java</span><span style="color: #212121">.</span><span style="color: #D32F2F">nio</span><span style="color: #212121">.</span><span style="color: #D32F2F">file</span><span style="color: #212121">.</span><span style="color: #D32F2F">Files</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L37"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">java</span><span style="color: #212121">.</span><span style="color: #D32F2F">nio</span><span style="color: #212121">.</span><span style="color: #D32F2F">file</span><span style="color: #212121">.</span><span style="color: #D32F2F">Path</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L38"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">java</span><span style="color: #212121">.</span><span style="color: #D32F2F">util</span><span style="color: #212121">.</span><span style="color: #D32F2F">ArrayList</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L39"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">java</span><span style="color: #212121">.</span><span style="color: #D32F2F">util</span><span style="color: #212121">.</span><span style="color: #D32F2F">List</span><span style="color: #24292EFF">;</span></span>
<span class="line empty-line" id="L40"></span>
<span class="line" id="L41"><span style="color: #D32F2F">public</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">class</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">SearchWithTermsEnum</span><span style="color: #24292EFF"> {</span></span>
<span class="line empty-line" id="L42"></span>
<span class="line empty-line" id="L43"></span></code></pre>
      
        
        <h2 id="creating-documents">Creating Documents</h2>

        
      
        
        <p>This set of documents is copied over from SimpleSearch. I’m just keeping it here too, because I want every
example class to be fully self-contained.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 47;"><span class="line" id="L47"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">private</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">static</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">List&lt;List&lt;</span><span style="color: #24292EFF">IndexableField</span><span style="color: #D32F2F">&gt;&gt;</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">createDocuments()</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L48"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">List</span><span style="color: #24292EFF">&lt;</span><span style="color: #D32F2F">String</span><span style="color: #24292EFF">&gt; texts </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">List</span><span style="color: #212121">.</span><span style="color: #6F42C1">of</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L49"><span style="color: #24292EFF">                </span><span style="color: #22863A">&quot;The quick fox jumped over the lazy, brown dog&quot;</span><span style="color: #212121">,</span></span>
<span class="line" id="L50"><span style="color: #24292EFF">                </span><span style="color: #22863A">&quot;Lorem ipsum, dolor sit amet&quot;</span><span style="color: #212121">,</span></span>
<span class="line" id="L51"><span style="color: #24292EFF">                </span><span style="color: #22863A">&quot;She left the web, she left the loom, she made three paces through the room&quot;</span><span style="color: #212121">,</span></span>
<span class="line" id="L52"><span style="color: #24292EFF">                </span><span style="color: #22863A">&quot;The sly fox sneaks past the oblivious dog&quot;</span></span>
<span class="line" id="L53"><span style="color: #24292EFF">        );</span></span>
<span class="line" id="L54"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">List</span><span style="color: #24292EFF">&lt;</span><span style="color: #D32F2F">List</span><span style="color: #24292EFF">&lt;</span><span style="color: #D32F2F">IndexableField</span><span style="color: #24292EFF">&gt;&gt; docs </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">ArrayList</span><span style="color: #24292EFF">&lt;&gt;();</span></span>
<span class="line" id="L55"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">String</span><span style="color: #24292EFF"> text </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> texts) {</span></span>
<span class="line" id="L56"><span style="color: #24292EFF">            </span><span style="color: #D32F2F">List</span><span style="color: #24292EFF">&lt;</span><span style="color: #D32F2F">IndexableField</span><span style="color: #24292EFF">&gt; doc </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">ArrayList</span><span style="color: #24292EFF">&lt;&gt;();</span></span>
<span class="line" id="L57"><span style="color: #24292EFF">            </span><span style="color: #1976D2">doc</span><span style="color: #212121">.</span><span style="color: #6F42C1">add</span><span style="color: #24292EFF">(</span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">TextField(</span><span style="color: #22863A">&quot;text&quot;</span><span style="color: #212121">,</span><span style="color: #6F42C1"> text</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #1976D2">Field</span><span style="color: #212121">.</span><span style="color: #1976D2">Store</span><span style="color: #212121">.</span><span style="color: #1976D2">YES</span><span style="color: #6F42C1">)</span><span style="color: #24292EFF">);</span></span>
<span class="line" id="L58"><span style="color: #24292EFF">            </span><span style="color: #1976D2">docs</span><span style="color: #212121">.</span><span style="color: #6F42C1">add</span><span style="color: #24292EFF">(doc);</span></span>
<span class="line" id="L59"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L60"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> docs;</span></span>
<span class="line" id="L61"><span style="color: #24292EFF">    }</span></span>
<span class="line empty-line" id="L62"></span>
<span class="line empty-line" id="L63"></span></code></pre>
      
        
        <h2 id="example-code">Example code</h2>

        
      
        
        
        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 65;"><span class="line" id="L65"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">public</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">static</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">void</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">main(</span><span style="color: #D32F2F">String</span><span style="color: #6F42C1">[] args)</span><span style="color: #24292EFF"> throws IOException {</span></span>
<span class="line empty-line" id="L66"></span>
<span class="line empty-line" id="L67"></span></code></pre>
      
        
        <p>As in the previous example, we will create a temporary directory, open it as a Lucene <code>Directory</code>, and
create an <code>IndexWriter</code>. Then we’ll add each of the example documents.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 70;"><span class="line" id="L70"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">Path</span><span style="color: #24292EFF"> tmpDir </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">Files</span><span style="color: #212121">.</span><span style="color: #6F42C1">createTempDirectory</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">SearchWithTermsEnum</span><span style="color: #212121">.</span><span style="color: #1976D2">class</span><span style="color: #212121">.</span><span style="color: #6F42C1">getSimpleName</span><span style="color: #24292EFF">());</span></span>
<span class="line" id="L71"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">try</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">Directory</span><span style="color: #24292EFF"> directory </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">FSDirectory</span><span style="color: #212121">.</span><span style="color: #6F42C1">open</span><span style="color: #24292EFF">(tmpDir);</span></span>
<span class="line" id="L72"><span style="color: #24292EFF">             </span><span style="color: #D32F2F">IndexWriter</span><span style="color: #24292EFF"> writer </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">IndexWriter(directory</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #D32F2F">new</span><span style="color: #6F42C1"> IndexWriterConfig())</span><span style="color: #24292EFF">) {</span></span>
<span class="line" id="L73"><span style="color: #24292EFF">            </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">List</span><span style="color: #24292EFF">&lt;</span><span style="color: #D32F2F">IndexableField</span><span style="color: #24292EFF">&gt; doc </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">createDocuments()</span><span style="color: #24292EFF">) {</span></span>
<span class="line" id="L74"><span style="color: #24292EFF">                </span><span style="color: #1976D2">writer</span><span style="color: #212121">.</span><span style="color: #6F42C1">addDocument</span><span style="color: #24292EFF">(doc);</span></span>
<span class="line empty-line" id="L75"></span></code></pre>
      
        
        <p><em>Exercise:</em> If you want to write each document to its own segment, you can uncomment this line:</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 76;"><span class="line" id="L76"><span style="color: #24292EFF">                </span><span style="color: #C2C3C5">/* writer.flush(); */</span></span>
<span class="line" id="L77"><span style="color: #24292EFF">            }</span></span>
<span class="line empty-line" id="L78"></span></code></pre>
      
        
        <p>Open the index reader, but this time we won’t use an <code>IndexSearcher</code>.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 79;"><span class="line" id="L79"><span style="color: #24292EFF">            </span><span style="color: #D32F2F">try</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">IndexReader</span><span style="color: #24292EFF"> reader </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">DirectoryReader</span><span style="color: #212121">.</span><span style="color: #6F42C1">open</span><span style="color: #24292EFF">(writer)) {</span></span>
<span class="line empty-line" id="L80"></span></code></pre>
      
        
        <p>The <code>IndexReader</code> provided by <code>DirectoryReader</code> is a form of <code>CompositeReader</code>, made up of
underlying “leaves”. These leaves are the flushed write-once segments of the index.</p>
<p>In this case, because we only flushed once, in the <code>DirectoryReader.open()</code> call, the index
only has one segment.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 86;"><span class="line" id="L86"><span style="color: #24292EFF">                </span><span style="color: #1976D2">System</span><span style="color: #212121">.</span><span style="color: #1976D2">out</span><span style="color: #212121">.</span><span style="color: #6F42C1">println</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;Our reader has &quot;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">reader</span><span style="color: #212121">.</span><span style="color: #6F42C1">leaves</span><span style="color: #24292EFF">()</span><span style="color: #212121">.</span><span style="color: #6F42C1">size</span><span style="color: #24292EFF">() </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&quot; segment(s)&quot;</span><span style="color: #24292EFF">);</span></span>
<span class="line empty-line" id="L87"></span>
<span class="line empty-line" id="L88"></span></code></pre>
      
        
        <p>We’ll iterate through the list of segments, because that’s essentially what <code>IndexSearcher</code> does,
though in this case it’s a list of length 1.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 91;"><span class="line" id="L91"><span style="color: #24292EFF">                </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">LeafReaderContext</span><span style="color: #24292EFF"> leafReaderContext </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">reader</span><span style="color: #212121">.</span><span style="color: #6F42C1">leaves</span><span style="color: #24292EFF">()) {</span></span>
<span class="line empty-line" id="L92"></span></code></pre>
      
        
        <p>We load the terms for the “text” field. The way we tokenized the text field (using the
default, implicit <code>StandardAnalyzer</code>), there is one term for each unique word in the documents.</p>
<p>If we have multiple segments (if we uncommented the <code>writer.flush()</code> line above), we see that
each segment has its own term dictionary.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 98;"><span class="line" id="L98"><span style="color: #24292EFF">                    </span><span style="color: #D32F2F">LeafReader</span><span style="color: #24292EFF"> leafReader </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">leafReaderContext</span><span style="color: #212121">.</span><span style="color: #6F42C1">reader</span><span style="color: #24292EFF">();</span></span>
<span class="line" id="L99"><span style="color: #24292EFF">                    </span><span style="color: #D32F2F">Terms</span><span style="color: #24292EFF"> textTerms </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">Terms</span><span style="color: #212121">.</span><span style="color: #6F42C1">getTerms</span><span style="color: #24292EFF">(leafReader</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&quot;text&quot;</span><span style="color: #24292EFF">);</span></span>
<span class="line" id="L100"><span style="color: #24292EFF">                    </span><span style="color: #1976D2">System</span><span style="color: #212121">.</span><span style="color: #1976D2">out</span><span style="color: #212121">.</span><span style="color: #6F42C1">println</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;Segment &quot;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">leafReaderContext</span><span style="color: #212121">.</span><span style="color: #1976D2">ord</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&quot; has &quot;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">textTerms</span><span style="color: #212121">.</span><span style="color: #6F42C1">size</span><span style="color: #24292EFF">() </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&quot; terms&quot;</span><span style="color: #24292EFF">);</span></span>
<span class="line empty-line" id="L101"></span>
<span class="line empty-line" id="L102"></span></code></pre>
      
        
        <p>We can iterate through all the terms using a <code>TermsEnum</code>:</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 104;"><span class="line" id="L104"><span style="color: #24292EFF">                    </span><span style="color: #D32F2F">TermsEnum</span><span style="color: #24292EFF"> textTermsEnum </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">textTerms</span><span style="color: #212121">.</span><span style="color: #6F42C1">iterator</span><span style="color: #24292EFF">();</span></span>
<span class="line" id="L105"><span style="color: #24292EFF">                    </span><span style="color: #1976D2">System</span><span style="color: #212121">.</span><span style="color: #1976D2">out</span><span style="color: #212121">.</span><span style="color: #6F42C1">println</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;The terms are:&quot;</span><span style="color: #24292EFF">);</span></span>
<span class="line" id="L106"><span style="color: #24292EFF">                    </span><span style="color: #D32F2F">BytesRef</span><span style="color: #24292EFF"> curTerm;</span></span>
<span class="line" id="L107"><span style="color: #24292EFF">                    </span><span style="color: #D32F2F">while</span><span style="color: #24292EFF"> ((curTerm </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">textTermsEnum</span><span style="color: #212121">.</span><span style="color: #6F42C1">next</span><span style="color: #24292EFF">()) </span><span style="color: #D32F2F">!=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">null</span><span style="color: #24292EFF">) {</span></span>
<span class="line" id="L108"><span style="color: #24292EFF">                        </span><span style="color: #1976D2">System</span><span style="color: #212121">.</span><span style="color: #1976D2">out</span><span style="color: #212121">.</span><span style="color: #6F42C1">println</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">curTerm</span><span style="color: #212121">.</span><span style="color: #6F42C1">utf8ToString</span><span style="color: #24292EFF">());</span></span>
<span class="line" id="L109"><span style="color: #24292EFF">                    }</span></span>
<span class="line empty-line" id="L110"></span>
<span class="line empty-line" id="L111"></span></code></pre>
      
        
        <p>When searching, though, we don’t iterate through all the terms, instead we use the <code>seekExact</code>
method.</p>
<p>Under the hood, all terms are indexed as arrays of bytes. Text terms are converted
to bytes by UTF-8 encoding. We can use the <code>new BytesRef(CharSequence)</code> constructor to
do the conversion.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 118;"><span class="line" id="L118"><span style="color: #24292EFF">                    textTermsEnum </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">textTerms</span><span style="color: #212121">.</span><span style="color: #6F42C1">iterator</span><span style="color: #24292EFF">(); </span><span style="color: #C2C3C5">/* Reset our iterator, since it previously hit the end */</span></span>
<span class="line" id="L119"><span style="color: #24292EFF">                    </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">textTermsEnum</span><span style="color: #212121">.</span><span style="color: #6F42C1">seekExact</span><span style="color: #24292EFF">(</span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">BytesRef(</span><span style="color: #22863A">&quot;fox&quot;</span><span style="color: #6F42C1">)</span><span style="color: #24292EFF">)) {</span></span>
<span class="line" id="L120"><span style="color: #24292EFF">                        </span><span style="color: #1976D2">System</span><span style="color: #212121">.</span><span style="color: #1976D2">out</span><span style="color: #212121">.</span><span style="color: #6F42C1">println</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;Found term &#39;fox&#39; in segment &quot;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">leafReaderContext</span><span style="color: #212121">.</span><span style="color: #1976D2">ord</span><span style="color: #24292EFF">);</span></span>
<span class="line empty-line" id="L121"></span>
<span class="line empty-line" id="L122"></span></code></pre>
      
        
        <p>Once the <code>TermsEnum</code> is pointing at a specific term, we can efficiently (<code>O(1)</code> time) see how
many documents contain the term.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 125;"><span class="line" id="L125"><span style="color: #24292EFF">                        </span><span style="color: #1976D2">System</span><span style="color: #212121">.</span><span style="color: #1976D2">out</span><span style="color: #212121">.</span><span style="color: #6F42C1">println</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;The term &#39;fox&#39; occurs in &quot;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">textTermsEnum</span><span style="color: #212121">.</span><span style="color: #6F42C1">docFreq</span><span style="color: #24292EFF">() </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&quot; documents in the current segment.&quot;</span><span style="color: #24292EFF">);</span></span>
<span class="line empty-line" id="L126"></span>
<span class="line empty-line" id="L127"></span></code></pre>
      
        
        <p>To find the specific documents matching a term, we retrieve a <code>PostingsEnum</code>. The <code>null</code>
parameter could be an old <code>PostingsEnum</code> that we want to reuse to reduce object allocation
overhead, but we don’t have an old <code>PostingsEnum</code>.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 131;"><span class="line" id="L131"><span style="color: #24292EFF">                        </span><span style="color: #D32F2F">PostingsEnum</span><span style="color: #24292EFF"> postingsEnum </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">textTermsEnum</span><span style="color: #212121">.</span><span style="color: #6F42C1">postings</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">null</span><span style="color: #24292EFF">);</span></span>
<span class="line" id="L132"><span style="color: #24292EFF">                        </span><span style="color: #D32F2F">int</span><span style="color: #24292EFF"> docId;</span></span>
<span class="line" id="L133"><span style="color: #24292EFF">                        </span><span style="color: #D32F2F">while</span><span style="color: #24292EFF"> ((docId </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">postingsEnum</span><span style="color: #212121">.</span><span style="color: #6F42C1">nextDoc</span><span style="color: #24292EFF">()) </span><span style="color: #D32F2F">!=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">DocIdSetIterator</span><span style="color: #212121">.</span><span style="color: #1976D2">NO_MORE_DOCS</span><span style="color: #24292EFF">) {</span></span>
<span class="line empty-line" id="L134"></span></code></pre>
      
        
        <p>The matching document IDs are local to the current segment. That is, each segment
starts counting doc IDs again from 0.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 137;"><span class="line" id="L137"><span style="color: #24292EFF">                            </span><span style="color: #1976D2">System</span><span style="color: #212121">.</span><span style="color: #1976D2">out</span><span style="color: #212121">.</span><span style="color: #6F42C1">println</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;Matching doc with id &quot;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> docId </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&quot;:&quot;</span><span style="color: #24292EFF">);</span></span>
<span class="line empty-line" id="L138"></span></code></pre>
      
        
        <p>As with the SimpleSearch example, we can load the stored fields to retrieve the full
<code>text</code> field value. In this case, though, we’re loading the segment-local <code>StoredFields</code>.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 140;"><span class="line" id="L140"><span style="color: #24292EFF">                            </span><span style="color: #D32F2F">StoredFields</span><span style="color: #24292EFF"> storedFields </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">leafReader</span><span style="color: #212121">.</span><span style="color: #6F42C1">storedFields</span><span style="color: #24292EFF">();</span></span>
<span class="line" id="L141"><span style="color: #24292EFF">                            </span><span style="color: #1976D2">System</span><span style="color: #212121">.</span><span style="color: #1976D2">out</span><span style="color: #212121">.</span><span style="color: #6F42C1">println</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">storedFields</span><span style="color: #212121">.</span><span style="color: #6F42C1">document</span><span style="color: #24292EFF">(docId)</span><span style="color: #212121">.</span><span style="color: #6F42C1">get</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;text&quot;</span><span style="color: #24292EFF">));</span></span>
<span class="line" id="L142"><span style="color: #24292EFF">                        }</span></span>
<span class="line" id="L143"><span style="color: #24292EFF">                    } </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> {</span></span>
<span class="line empty-line" id="L144"></span></code></pre>
      
        
        <p>This should only happen if we explicitly flush.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 146;"><span class="line" id="L146"><span style="color: #24292EFF">                        </span><span style="color: #1976D2">System</span><span style="color: #212121">.</span><span style="color: #1976D2">out</span><span style="color: #212121">.</span><span style="color: #6F42C1">println</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;Did not find term &#39;fox&#39; in segment &quot;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">leafReaderContext</span><span style="color: #212121">.</span><span style="color: #1976D2">ord</span><span style="color: #24292EFF">);</span></span>
<span class="line" id="L147"><span style="color: #24292EFF">                    }</span></span>
<span class="line empty-line" id="L148"></span></code></pre>
      
        
        
        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 149;"><span class="line" id="L149"><span style="color: #24292EFF">                }</span></span>
<span class="line" id="L150"><span style="color: #24292EFF">            }</span></span>
<span class="line" id="L151"><span style="color: #24292EFF">        } </span><span style="color: #D32F2F">finally</span><span style="color: #24292EFF"> {</span></span>
<span class="line empty-line" id="L152"></span></code></pre>
      
        
        <h2 id="cleanup">Cleanup</h2>

        
      
        
        <p>As in the previous example, we’ll clean up the temporary files to avoid cluttering your hard disk.</p>

        <pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 155;"><span class="line" id="L155"><span style="color: #24292EFF">            </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">String</span><span style="color: #24292EFF"> indexFile </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">FSDirectory</span><span style="color: #212121">.</span><span style="color: #6F42C1">listAll</span><span style="color: #24292EFF">(tmpDir)) {</span></span>
<span class="line" id="L156"><span style="color: #24292EFF">                </span><span style="color: #1976D2">Files</span><span style="color: #212121">.</span><span style="color: #6F42C1">deleteIfExists</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">tmpDir</span><span style="color: #212121">.</span><span style="color: #6F42C1">resolve</span><span style="color: #24292EFF">(indexFile));</span></span>
<span class="line" id="L157"><span style="color: #24292EFF">            }</span></span>
<span class="line" id="L158"><span style="color: #24292EFF">            </span><span style="color: #1976D2">Files</span><span style="color: #212121">.</span><span style="color: #6F42C1">deleteIfExists</span><span style="color: #24292EFF">(tmpDir);</span></span>
<span class="line" id="L159"><span style="color: #24292EFF">        }</span></span>
<span class="line empty-line" id="L160"></span>
<span class="line" id="L161"><span style="color: #24292EFF">    }</span></span>
<span class="line empty-line" id="L162"></span>
<span class="line empty-line" id="L163"></span>
<span class="line" id="L164"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L165"></span>
<span class="line empty-line" id="L166"></span></code></pre>
      
    </div>
    <footer>
      <div>
        Generated by <a href="https://github.com/mercmobily/docco">Docco</a>
      </div>
    </footer>
  </div>
</body>
</html>
