<!DOCTYPE html>

<html>
<head>
  <title>How range queries over point trees work</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="AnalyzerBasics.html">
                  AnalyzerBasics.java
                </a>
              
                
                <a class="source" href="BooleanQueryANDInternals.html">
                  BooleanQueryANDInternals.java
                </a>
              
                
                <a class="source" href="BooleanQueryIntro.html">
                  BooleanQueryIntro.java
                </a>
              
                
                <a class="source" href="BottomUpIndexReader.html">
                  BottomUpIndexReader.java
                </a>
              
                
                <a class="source" href="BytesRefHashExample.html">
                  BytesRefHashExample.java
                </a>
              
                
                <a class="source" href="CombinedFieldQueryExample.html">
                  CombinedFieldQueryExample.java
                </a>
              
                
                <a class="source" href="DirectoryFileContents.html">
                  DirectoryFileContents.java
                </a>
              
                
                <a class="source" href="DocValuesSearchExample.html">
                  DocValuesSearchExample.java
                </a>
              
                
                <a class="source" href="FunctionQuerySearchExample.html">
                  FunctionQuerySearchExample.java
                </a>
              
                
                <a class="source" href="KnnSearchExample.html">
                  KnnSearchExample.java
                </a>
              
                
                <a class="source" href="PointTreeRangeQuery.html">
                  PointTreeRangeQuery.java
                </a>
              
                
                <a class="source" href="PrimitivesRef.html">
                  PrimitivesRef.java
                </a>
              
                
                <a class="source" href="SearchWithTermsEnum.html">
                  SearchWithTermsEnum.java
                </a>
              
                
                <a class="source" href="SimpleSearch.html">
                  SimpleSearch.java
                </a>
              
                
                <a class="source" href="TextVectorSearchExample.html">
                  TextVectorSearchExample.java
                </a>
              
                
                <a class="source" href="VisualizePointTree.html">
                  VisualizePointTree.java
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <p>Previously, in VisualizePointTree, we output a binary K-D tree for a set of points in an IntField. In this example,
we will once again write points for an IntField, but this will focus on how the tree structure makes efficient
range matching possible.</p>
<p>We will first run a regular PointRangeQuery using the high-level IndexSearcher API. Next, we will recreate the range
query internals with a custom <code>PointValues.IntersectVisitor</code> and pass that to the <code>PointValues.intersect()</code> method.
Finally, we’ll implement our own tree “intersect” method to show how the tree and visitor work together to find
documents that match the given range.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 12;"><span class="line" id="L12"><span style="color: #D32F2F">package</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">example</span><span style="color: #212121">.</span><span style="color: #D32F2F">points</span><span style="color: #24292EFF">;</span></span>
<span class="line empty-line" id="L13"></span>
<span class="line" id="L14"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">example</span><span style="color: #212121">.</span><span style="color: #D32F2F">basic</span><span style="color: #212121">.</span><span style="color: #D32F2F">SimpleSearch</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L15"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">document</span><span style="color: #212121">.</span><span style="color: #D32F2F">Field</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L16"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">document</span><span style="color: #212121">.</span><span style="color: #D32F2F">IntField</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L17"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">document</span><span style="color: #212121">.</span><span style="color: #D32F2F">IntPoint</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L18"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">document</span><span style="color: #212121">.</span><span style="color: #D32F2F">KeywordField</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L19"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">DirectoryReader</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L20"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">IndexReader</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L21"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">IndexWriter</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L22"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">IndexWriterConfig</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L23"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">LeafReaderContext</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L24"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">index</span><span style="color: #212121">.</span><span style="color: #D32F2F">PointValues</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L25"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">search</span><span style="color: #212121">.</span><span style="color: #D32F2F">IndexSearcher</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L26"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">search</span><span style="color: #212121">.</span><span style="color: #D32F2F">Query</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L27"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">search</span><span style="color: #212121">.</span><span style="color: #D32F2F">TotalHitCountCollectorManager</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L28"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">store</span><span style="color: #212121">.</span><span style="color: #D32F2F">Directory</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L29"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">org</span><span style="color: #212121">.</span><span style="color: #D32F2F">apache</span><span style="color: #212121">.</span><span style="color: #D32F2F">lucene</span><span style="color: #212121">.</span><span style="color: #D32F2F">store</span><span style="color: #212121">.</span><span style="color: #D32F2F">FSDirectory</span><span style="color: #24292EFF">;</span></span>
<span class="line empty-line" id="L30"></span>
<span class="line" id="L31"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">java</span><span style="color: #212121">.</span><span style="color: #D32F2F">io</span><span style="color: #212121">.</span><span style="color: #D32F2F">IOException</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L32"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">java</span><span style="color: #212121">.</span><span style="color: #D32F2F">nio</span><span style="color: #212121">.</span><span style="color: #D32F2F">file</span><span style="color: #212121">.</span><span style="color: #D32F2F">Files</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L33"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">java</span><span style="color: #212121">.</span><span style="color: #D32F2F">nio</span><span style="color: #212121">.</span><span style="color: #D32F2F">file</span><span style="color: #212121">.</span><span style="color: #D32F2F">Path</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L34"><span style="color: #D32F2F">import</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">java</span><span style="color: #212121">.</span><span style="color: #D32F2F">util</span><span style="color: #212121">.</span><span style="color: #D32F2F">List</span><span style="color: #24292EFF">;</span></span>
<span class="line empty-line" id="L35"></span>
<span class="line" id="L36"><span style="color: #D32F2F">public</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">class</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">PointTreeRangeQuery</span><span style="color: #24292EFF"> {</span></span>
<span class="line empty-line" id="L37"></span>
<span class="line empty-line" id="L38"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <h2 id="the-worked-example">The worked example</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 39;"><span class="line" id="L39"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">public</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">static</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">void</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">main(</span><span style="color: #D32F2F">String</span><span style="color: #6F42C1">[] args)</span><span style="color: #24292EFF"> throws IOException {</span></span>
<span class="line empty-line" id="L40"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <p>Create a temporary directory to hold the index, then create the Lucene Directory and IndexWriter.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 41;"><span class="line" id="L41"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">Path</span><span style="color: #24292EFF"> tmpDir </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">Files</span><span style="color: #212121">.</span><span style="color: #6F42C1">createTempDirectory</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">SimpleSearch</span><span style="color: #212121">.</span><span style="color: #1976D2">class</span><span style="color: #212121">.</span><span style="color: #6F42C1">getSimpleName</span><span style="color: #24292EFF">());</span></span>
<span class="line" id="L42"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">try</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">Directory</span><span style="color: #24292EFF"> directory </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">FSDirectory</span><span style="color: #212121">.</span><span style="color: #6F42C1">open</span><span style="color: #24292EFF">(tmpDir);</span></span>
<span class="line" id="L43"><span style="color: #24292EFF">             </span><span style="color: #D32F2F">IndexWriter</span><span style="color: #24292EFF"> writer </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">IndexWriter(directory</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #D32F2F">new</span><span style="color: #6F42C1"> IndexWriterConfig())</span><span style="color: #24292EFF">) {</span></span>
<span class="line empty-line" id="L44"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <h3 id="index-documents">Index documents</h3>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p>As in VisualizePointTree, we will generate 20,000 documents, distributed over 10,000 integer point values.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 48;"><span class="line" id="L48"><span style="color: #24292EFF">            </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">int</span><span style="color: #24292EFF"> i </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">0</span><span style="color: #24292EFF">; i </span><span style="color: #D32F2F">&lt;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">10_000</span><span style="color: #24292EFF">; i</span><span style="color: #D32F2F">++</span><span style="color: #24292EFF">) {</span></span>
<span class="line" id="L49"><span style="color: #24292EFF">                </span><span style="color: #1976D2">writer</span><span style="color: #212121">.</span><span style="color: #6F42C1">addDocument</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">List</span><span style="color: #212121">.</span><span style="color: #6F42C1">of</span><span style="color: #24292EFF">(</span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">KeywordField(</span><span style="color: #22863A">&quot;id&quot;</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #22863A">&quot;first &quot;</span><span style="color: #6F42C1"> </span><span style="color: #D32F2F">+</span><span style="color: #6F42C1"> i</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #1976D2">Field</span><span style="color: #212121">.</span><span style="color: #1976D2">Store</span><span style="color: #212121">.</span><span style="color: #1976D2">NO</span><span style="color: #6F42C1">)</span><span style="color: #212121">,</span></span>
<span class="line" id="L50"><span style="color: #24292EFF">                        </span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">IntField(</span><span style="color: #22863A">&quot;val&quot;</span><span style="color: #212121">,</span><span style="color: #6F42C1"> i</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #1976D2">Field</span><span style="color: #212121">.</span><span style="color: #1976D2">Store</span><span style="color: #212121">.</span><span style="color: #1976D2">NO</span><span style="color: #6F42C1">)</span><span style="color: #24292EFF">));</span></span>
<span class="line" id="L51"><span style="color: #24292EFF">                </span><span style="color: #1976D2">writer</span><span style="color: #212121">.</span><span style="color: #6F42C1">addDocument</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">List</span><span style="color: #212121">.</span><span style="color: #6F42C1">of</span><span style="color: #24292EFF">(</span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">KeywordField(</span><span style="color: #22863A">&quot;id&quot;</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #22863A">&quot;second &quot;</span><span style="color: #6F42C1"> </span><span style="color: #D32F2F">+</span><span style="color: #6F42C1"> i</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #1976D2">Field</span><span style="color: #212121">.</span><span style="color: #1976D2">Store</span><span style="color: #212121">.</span><span style="color: #1976D2">NO</span><span style="color: #6F42C1">)</span><span style="color: #212121">,</span></span>
<span class="line" id="L52"><span style="color: #24292EFF">                        </span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">IntField(</span><span style="color: #22863A">&quot;val&quot;</span><span style="color: #212121">,</span><span style="color: #6F42C1"> i</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #1976D2">Field</span><span style="color: #212121">.</span><span style="color: #1976D2">Store</span><span style="color: #212121">.</span><span style="color: #1976D2">NO</span><span style="color: #6F42C1">)</span><span style="color: #24292EFF">));</span></span>
<span class="line" id="L53"><span style="color: #24292EFF">            }</span></span>
<span class="line empty-line" id="L54"></span>
<span class="line empty-line" id="L55"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <h3 id="search-over-a-range">Search over a range</h3>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p>We will search over the range [2000,3999], which will match 4000 documents (since each point has two
associated documents).</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 59;"><span class="line" id="L59"><span style="color: #24292EFF">            </span><span style="color: #D32F2F">try</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">IndexReader</span><span style="color: #24292EFF"> reader </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">DirectoryReader</span><span style="color: #212121">.</span><span style="color: #6F42C1">open</span><span style="color: #24292EFF">(writer)) {</span></span>
<span class="line" id="L60"><span style="color: #24292EFF">                </span><span style="color: #D32F2F">IndexSearcher</span><span style="color: #24292EFF"> searcher </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">IndexSearcher(reader)</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L61"><span style="color: #24292EFF">                </span><span style="color: #D32F2F">Query</span><span style="color: #24292EFF"> pointRangeQuery </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">IntPoint</span><span style="color: #212121">.</span><span style="color: #6F42C1">newRangeQuery</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;val&quot;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">2000</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">3999</span><span style="color: #24292EFF">);</span></span>
<span class="line" id="L62"><span style="color: #24292EFF">                </span><span style="color: #D32F2F">int</span><span style="color: #24292EFF"> count </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">searcher</span><span style="color: #212121">.</span><span style="color: #6F42C1">search</span><span style="color: #24292EFF">(pointRangeQuery</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">TotalHitCountCollectorManager(</span><span style="color: #1976D2">searcher</span><span style="color: #212121">.</span><span style="color: #6F42C1">getSlices())</span><span style="color: #24292EFF">);</span></span>
<span class="line" id="L63"><span style="color: #24292EFF">                </span><span style="color: #1976D2">System</span><span style="color: #212121">.</span><span style="color: #1976D2">out</span><span style="color: #212121">.</span><span style="color: #6F42C1">println</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;Query &quot;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> pointRangeQuery </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&quot; matched &quot;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> count </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&quot; documents&quot;</span><span style="color: #24292EFF">);</span></span>
<span class="line empty-line" id="L64"></span>
<span class="line empty-line" id="L65"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <p>Let’s do that again, but without the range query or index searcher. Instead, we will pass an
IntersectVisitor to collect the intersecting points’ doc IDs.</p>
<p>We’ll allocate a single-element <code>int[]</code> to hold our document counter (so we can reference the
variable from our anonymous IntersectVisitor).</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 72;"><span class="line" id="L72"><span style="color: #24292EFF">                </span><span style="color: #D32F2F">int</span><span style="color: #24292EFF">[] countHolder </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">int</span><span style="color: #24292EFF">[</span><span style="color: #1976D2">1</span><span style="color: #24292EFF">];</span></span>
<span class="line" id="L73"><span style="color: #24292EFF">                </span><span style="color: #D32F2F">PointValues</span><span style="color: #212121">.</span><span style="color: #D32F2F">IntersectVisitor</span><span style="color: #24292EFF"> intersectVisitor </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">new</span><span style="color: #24292EFF"> PointValues</span><span style="color: #212121">.</span><span style="color: #6F42C1">IntersectVisitor</span><span style="color: #24292EFF">() {</span></span>
<span class="line empty-line" id="L74"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <p>This version of <code>visit</code> gets called when we know that every doc in the current leaf node matches.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 75;"><span class="line" id="L75"><span style="color: #24292EFF">                    @</span><span style="color: #D32F2F">Override</span></span>
<span class="line" id="L76"><span style="color: #24292EFF">                    </span><span style="color: #D32F2F">public</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">void</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">visit(</span><span style="color: #D32F2F">int</span><span style="color: #6F42C1"> docID)</span><span style="color: #24292EFF"> throws IOException {</span></span>
<span class="line" id="L77"><span style="color: #24292EFF">                        countHolder[</span><span style="color: #1976D2">0</span><span style="color: #24292EFF">]</span><span style="color: #D32F2F">++</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L78"><span style="color: #24292EFF">                    }</span></span>
<span class="line empty-line" id="L79"></span>
<span class="line empty-line" id="L80"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <p>This version of <code>visit</code> is called when the current leaf node partially matches the range.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 81;"><span class="line" id="L81"><span style="color: #24292EFF">                    @</span><span style="color: #D32F2F">Override</span></span>
<span class="line" id="L82"><span style="color: #24292EFF">                    </span><span style="color: #D32F2F">public</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">void</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">visit(</span><span style="color: #D32F2F">int</span><span style="color: #6F42C1"> docID</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #D32F2F">byte</span><span style="color: #6F42C1">[] packedValue)</span><span style="color: #24292EFF"> throws IOException {</span></span>
<span class="line" id="L83"><span style="color: #24292EFF">                        </span><span style="color: #D32F2F">int</span><span style="color: #24292EFF"> val </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">IntPoint</span><span style="color: #212121">.</span><span style="color: #6F42C1">decodeDimension</span><span style="color: #24292EFF">(packedValue</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">0</span><span style="color: #24292EFF">);</span></span>
<span class="line" id="L84"><span style="color: #24292EFF">                        </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (val </span><span style="color: #D32F2F">&gt;=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">2000</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> val </span><span style="color: #D32F2F">&lt;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">4000</span><span style="color: #24292EFF">) {</span></span>
<span class="line" id="L85"><span style="color: #24292EFF">                            countHolder[</span><span style="color: #1976D2">0</span><span style="color: #24292EFF">]</span><span style="color: #D32F2F">++</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L86"><span style="color: #24292EFF">                        }</span></span>
<span class="line" id="L87"><span style="color: #24292EFF">                    }</span></span>
<span class="line empty-line" id="L88"></span>
<span class="line" id="L89"><span style="color: #24292EFF">                    @</span><span style="color: #D32F2F">Override</span></span>
<span class="line" id="L90"><span style="color: #24292EFF">                    </span><span style="color: #D32F2F">public</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">PointValues</span><span style="color: #212121">.</span><span style="color: #1976D2">Relation</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">compare(</span><span style="color: #D32F2F">byte</span><span style="color: #6F42C1">[] minPackedValue</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #D32F2F">byte</span><span style="color: #6F42C1">[] maxPackedValue)</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L91"><span style="color: #24292EFF">                        </span><span style="color: #D32F2F">int</span><span style="color: #24292EFF"> minVal </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">IntPoint</span><span style="color: #212121">.</span><span style="color: #6F42C1">decodeDimension</span><span style="color: #24292EFF">(minPackedValue</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">0</span><span style="color: #24292EFF">);</span></span>
<span class="line" id="L92"><span style="color: #24292EFF">                        </span><span style="color: #D32F2F">int</span><span style="color: #24292EFF"> maxVal </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">IntPoint</span><span style="color: #212121">.</span><span style="color: #6F42C1">decodeDimension</span><span style="color: #24292EFF">(maxPackedValue</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">0</span><span style="color: #24292EFF">);</span></span>
<span class="line" id="L93"><span style="color: #24292EFF">                        </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (minVal </span><span style="color: #D32F2F">&gt;=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">2000</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> maxVal </span><span style="color: #D32F2F">&lt;=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">4000</span><span style="color: #24292EFF">) {</span></span>
<span class="line" id="L94"><span style="color: #24292EFF">                            </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">PointValues</span><span style="color: #212121">.</span><span style="color: #1976D2">Relation</span><span style="color: #212121">.</span><span style="color: #1976D2">CELL_INSIDE_QUERY</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L95"><span style="color: #24292EFF">                        } </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (minVal </span><span style="color: #D32F2F">&gt;=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">4000</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">||</span><span style="color: #24292EFF"> maxVal </span><span style="color: #D32F2F">&lt;=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">2000</span><span style="color: #24292EFF">) {</span></span>
<span class="line" id="L96"><span style="color: #24292EFF">                            </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">PointValues</span><span style="color: #212121">.</span><span style="color: #1976D2">Relation</span><span style="color: #212121">.</span><span style="color: #1976D2">CELL_OUTSIDE_QUERY</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L97"><span style="color: #24292EFF">                        }</span></span>
<span class="line" id="L98"><span style="color: #24292EFF">                        </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">PointValues</span><span style="color: #212121">.</span><span style="color: #1976D2">Relation</span><span style="color: #212121">.</span><span style="color: #1976D2">CELL_CROSSES_QUERY</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L99"><span style="color: #24292EFF">                    }</span></span>
<span class="line" id="L100"><span style="color: #24292EFF">                };</span></span>
<span class="line" id="L101"><span style="color: #24292EFF">                </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">LeafReaderContext</span><span style="color: #24292EFF"> lrc </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">reader</span><span style="color: #212121">.</span><span style="color: #6F42C1">leaves</span><span style="color: #24292EFF">()) {</span></span>
<span class="line" id="L102"><span style="color: #24292EFF">                    </span><span style="color: #1976D2">lrc</span><span style="color: #212121">.</span><span style="color: #6F42C1">reader</span><span style="color: #24292EFF">()</span><span style="color: #212121">.</span><span style="color: #6F42C1">getPointValues</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;val&quot;</span><span style="color: #24292EFF">)</span><span style="color: #212121">.</span><span style="color: #6F42C1">intersect</span><span style="color: #24292EFF">(intersectVisitor);</span></span>
<span class="line" id="L103"><span style="color: #24292EFF">                }</span></span>
<span class="line" id="L104"><span style="color: #24292EFF">                </span><span style="color: #1976D2">System</span><span style="color: #212121">.</span><span style="color: #1976D2">out</span><span style="color: #212121">.</span><span style="color: #6F42C1">println</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;Our IntersectVisitor counted &quot;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> countHolder[</span><span style="color: #1976D2">0</span><span style="color: #24292EFF">] </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&quot; documents&quot;</span><span style="color: #24292EFF">);</span></span>
<span class="line empty-line" id="L105"></span>
<span class="line empty-line" id="L106"></span>
<span class="line empty-line" id="L107"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <p>Now we’re going to use custom traversal code that roughly simulates the behavior of the <code>intersect</code>
method. See the <code>customIntersect</code> definition below.</p>
<p>Reset the document count.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 111;"><span class="line" id="L111"><span style="color: #24292EFF">                countHolder[</span><span style="color: #1976D2">0</span><span style="color: #24292EFF">] </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">0</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L112"><span style="color: #24292EFF">                </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">LeafReaderContext</span><span style="color: #24292EFF"> lrc </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">reader</span><span style="color: #212121">.</span><span style="color: #6F42C1">leaves</span><span style="color: #24292EFF">()) {</span></span>
<span class="line" id="L113"><span style="color: #24292EFF">                    </span><span style="color: #D32F2F">PointValues</span><span style="color: #212121">.</span><span style="color: #D32F2F">PointTree</span><span style="color: #24292EFF"> tree </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">lrc</span><span style="color: #212121">.</span><span style="color: #6F42C1">reader</span><span style="color: #24292EFF">()</span><span style="color: #212121">.</span><span style="color: #6F42C1">getPointValues</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;val&quot;</span><span style="color: #24292EFF">)</span><span style="color: #212121">.</span><span style="color: #6F42C1">getPointTree</span><span style="color: #24292EFF">();</span></span>
<span class="line" id="L114"><span style="color: #24292EFF">                    </span><span style="color: #6F42C1">customIntersect(tree</span><span style="color: #212121">,</span><span style="color: #6F42C1"> intersectVisitor)</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L115"><span style="color: #24292EFF">                }</span></span>
<span class="line" id="L116"><span style="color: #24292EFF">                </span><span style="color: #1976D2">System</span><span style="color: #212121">.</span><span style="color: #1976D2">out</span><span style="color: #212121">.</span><span style="color: #6F42C1">println</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;Our custom intersection logic counted &quot;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> countHolder[</span><span style="color: #1976D2">0</span><span style="color: #24292EFF">] </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&quot; documents&quot;</span><span style="color: #24292EFF">);</span></span>
<span class="line" id="L117"><span style="color: #24292EFF">            }</span></span>
<span class="line" id="L118"><span style="color: #24292EFF">        } </span><span style="color: #D32F2F">finally</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L119"><span style="color: #24292EFF">            </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">String</span><span style="color: #24292EFF"> indexFile </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">FSDirectory</span><span style="color: #212121">.</span><span style="color: #6F42C1">listAll</span><span style="color: #24292EFF">(tmpDir)) {</span></span>
<span class="line" id="L120"><span style="color: #24292EFF">                </span><span style="color: #1976D2">Files</span><span style="color: #212121">.</span><span style="color: #6F42C1">deleteIfExists</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">tmpDir</span><span style="color: #212121">.</span><span style="color: #6F42C1">resolve</span><span style="color: #24292EFF">(indexFile));</span></span>
<span class="line" id="L121"><span style="color: #24292EFF">            }</span></span>
<span class="line empty-line" id="L122"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <p>Then we delete the directory itself.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 123;"><span class="line" id="L123"><span style="color: #24292EFF">            </span><span style="color: #1976D2">Files</span><span style="color: #212121">.</span><span style="color: #6F42C1">deleteIfExists</span><span style="color: #24292EFF">(tmpDir);</span></span>
<span class="line" id="L124"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L125"><span style="color: #24292EFF">    }</span></span>
<span class="line empty-line" id="L126"></span>
<span class="line" id="L127"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">private</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">static</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">void</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">customIntersect(</span><span style="color: #1976D2">PointValues</span><span style="color: #212121">.</span><span style="color: #1976D2">PointTree</span><span style="color: #6F42C1"> tree</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #1976D2">PointValues</span><span style="color: #212121">.</span><span style="color: #1976D2">IntersectVisitor</span><span style="color: #6F42C1"> visitor)</span><span style="color: #24292EFF"> throws IOException {</span></span>
<span class="line" id="L128"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">switch</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">visitor</span><span style="color: #212121">.</span><span style="color: #6F42C1">compare</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">tree</span><span style="color: #212121">.</span><span style="color: #6F42C1">getMinPackedValue</span><span style="color: #24292EFF">()</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">tree</span><span style="color: #212121">.</span><span style="color: #6F42C1">getMaxPackedValue</span><span style="color: #24292EFF">())) {</span></span>
<span class="line" id="L129"><span style="color: #24292EFF">            </span><span style="color: #D32F2F">case</span><span style="color: #24292EFF"> CELL_OUTSIDE_QUERY </span><span style="color: #D32F2F">-&gt;</span><span style="color: #24292EFF"> {</span></span>
<span class="line empty-line" id="L130"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p>Nothing to match on this node. Return without matching anything.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 131;"><span class="line" id="L131"><span style="color: #24292EFF">            }</span></span>
<span class="line" id="L132"><span style="color: #24292EFF">            </span><span style="color: #D32F2F">case</span><span style="color: #24292EFF"> CELL_INSIDE_QUERY </span><span style="color: #D32F2F">-&gt;</span><span style="color: #24292EFF"> {</span></span>
<span class="line empty-line" id="L133"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <p>This node is entirely contained within the visitor’s range. Collect everything under this node.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 134;"><span class="line" id="L134"><span style="color: #24292EFF">                </span><span style="color: #6F42C1">collectEverything(tree</span><span style="color: #212121">,</span><span style="color: #6F42C1"> visitor)</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L135"><span style="color: #24292EFF">            }</span></span>
<span class="line" id="L136"><span style="color: #24292EFF">            </span><span style="color: #D32F2F">case</span><span style="color: #24292EFF"> CELL_CROSSES_QUERY </span><span style="color: #D32F2F">-&gt;</span><span style="color: #24292EFF"> {</span></span>
<span class="line empty-line" id="L137"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <p>The node overlaps the visitor’s range. If it’s a leaf, then iterate through each point.
Otherwise, recurse into the children.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 139;"><span class="line" id="L139"><span style="color: #24292EFF">                </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">tree</span><span style="color: #212121">.</span><span style="color: #6F42C1">moveToChild</span><span style="color: #24292EFF">()) {</span></span>
<span class="line empty-line" id="L140"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <p>Not a leaf node. Visit the first child and all of its siblings.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 141;"><span class="line" id="L141"><span style="color: #24292EFF">                    </span><span style="color: #6F42C1">customIntersect(tree</span><span style="color: #212121">,</span><span style="color: #6F42C1"> visitor)</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L142"><span style="color: #24292EFF">                    </span><span style="color: #D32F2F">while</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">tree</span><span style="color: #212121">.</span><span style="color: #6F42C1">moveToSibling</span><span style="color: #24292EFF">()) {</span></span>
<span class="line" id="L143"><span style="color: #24292EFF">                        </span><span style="color: #6F42C1">customIntersect(tree</span><span style="color: #212121">,</span><span style="color: #6F42C1"> visitor)</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L144"><span style="color: #24292EFF">                    }</span></span>
<span class="line" id="L145"><span style="color: #24292EFF">                    </span><span style="color: #1976D2">tree</span><span style="color: #212121">.</span><span style="color: #6F42C1">moveToParent</span><span style="color: #24292EFF">();</span></span>
<span class="line" id="L146"><span style="color: #24292EFF">                } </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> {</span></span>
<span class="line empty-line" id="L147"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <p>A leaf node. Consider each value in the node.
Note that we don’t need to visit siblings, since they’re handled by the parent call.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 149;"><span class="line" id="L149"><span style="color: #24292EFF">                    </span><span style="color: #1976D2">tree</span><span style="color: #212121">.</span><span style="color: #6F42C1">visitDocValues</span><span style="color: #24292EFF">(visitor);</span></span>
<span class="line" id="L150"><span style="color: #24292EFF">                }</span></span>
<span class="line" id="L151"><span style="color: #24292EFF">            }</span></span>
<span class="line" id="L152"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L153"><span style="color: #24292EFF">    }</span></span>
<span class="line empty-line" id="L154"></span>
<span class="line empty-line" id="L155"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <p>The following helper method will collect all documents under the current node (regardless of the documents
associated values). We call this when we have determined that the current node is entirely contained within
the query range.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 158;"><span class="line" id="L158"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">private</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">static</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">void</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">collectEverything(</span><span style="color: #1976D2">PointValues</span><span style="color: #212121">.</span><span style="color: #1976D2">PointTree</span><span style="color: #6F42C1"> tree</span><span style="color: #212121">,</span><span style="color: #6F42C1"> </span><span style="color: #1976D2">PointValues</span><span style="color: #212121">.</span><span style="color: #1976D2">IntersectVisitor</span><span style="color: #6F42C1"> visitor)</span><span style="color: #24292EFF"> throws IOException {</span></span>
<span class="line" id="L159"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">tree</span><span style="color: #212121">.</span><span style="color: #6F42C1">moveToChild</span><span style="color: #24292EFF">()) {</span></span>
<span class="line empty-line" id="L160"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <p>Not a leaf. Recursively call this method on the first child and its siblings before moving back up.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 161;"><span class="line" id="L161"><span style="color: #24292EFF">            </span><span style="color: #6F42C1">collectEverything(tree</span><span style="color: #212121">,</span><span style="color: #6F42C1"> visitor)</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L162"><span style="color: #24292EFF">            </span><span style="color: #D32F2F">while</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">tree</span><span style="color: #212121">.</span><span style="color: #6F42C1">moveToSibling</span><span style="color: #24292EFF">()) {</span></span>
<span class="line" id="L163"><span style="color: #24292EFF">                </span><span style="color: #6F42C1">collectEverything(tree</span><span style="color: #212121">,</span><span style="color: #6F42C1"> visitor)</span><span style="color: #24292EFF">;</span></span>
<span class="line" id="L164"><span style="color: #24292EFF">            }</span></span>
<span class="line" id="L165"><span style="color: #24292EFF">            </span><span style="color: #1976D2">tree</span><span style="color: #212121">.</span><span style="color: #6F42C1">moveToParent</span><span style="color: #24292EFF">();</span></span>
<span class="line" id="L166"><span style="color: #24292EFF">        } </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> {</span></span>
<span class="line empty-line" id="L167"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <p>This is a leaf. Collect all of its doc IDs.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 168;"><span class="line" id="L168"><span style="color: #24292EFF">            </span><span style="color: #1976D2">tree</span><span style="color: #212121">.</span><span style="color: #6F42C1">visitDocIDs</span><span style="color: #24292EFF">(visitor);</span></span>
<span class="line" id="L169"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L170"><span style="color: #24292EFF">    }</span></span>
<span class="line" id="L171"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L172"></span>
<span class="line empty-line" id="L173"></span></code></pre></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
